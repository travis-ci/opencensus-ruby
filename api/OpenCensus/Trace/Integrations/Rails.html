<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: OpenCensus::Trace::Integrations::Rails
  
    &mdash; Documentation by YARD 0.9.12
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  pathId = "OpenCensus::Trace::Integrations::Rails";
  relpath = '../../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Integrations.html" title="OpenCensus::Trace::Integrations (module)">Integrations</a></span></span>
     &raquo; 
    <span class="title">Rails</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: OpenCensus::Trace::Integrations::Rails
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Rails::Railtie</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Rails::Railtie</li>
          
            <li class="next">OpenCensus::Trace::Integrations::Rails</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/opencensus/trace/integrations/rails.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p># Rails Integration</p>

<p>This Railtie automatically sets up OpenCensus for a Rails server:</p>
<ul><li>
<p>It wraps all requests in spans, using the `RackMiddleware` integration.</p>
</li><li>
<p>It wraps common events (ActiveRecord database calls, ActionView renders,
etc) in subspans.</p>
</li></ul>

<p>## Configuration</p>

<p>This Railtie exposes the OpenCensus configuration on the `opencensus` key
of the Rails configuration. So you can, for example, set:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_opencensus'>opencensus</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_default_max_attributes'>default_max_attributes</span> <span class='op'>=</span> <span class='int'>64</span>
</code></pre>

<p>### Configuring ActiveSupport Notifications</p>

<p>This Railtie also provides a `notifications` configuration that supports
the following fields:</p>
<ul><li>
<p>`events` An array of strings indicating the events that will trigger the
creation of spans. The default value is
<span class='object_link'><a href="#DEFAULT_NOTIFICATION_EVENTS-constant" title="OpenCensus::Trace::Integrations::Rails::DEFAULT_NOTIFICATION_EVENTS (constant)">DEFAULT_NOTIFICATION_EVENTS</a></span>.</p>
</li><li>
<p>`attribute_namespace` A string that will be prepended to all attributes
copied from the event payload. Defaults to “`rails/`”</p>
</li></ul>

<p>You can access these in the `notifications` subconfiguration under the
trace configuration. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_config'><span class='object_link'><a href="../../Trace.html#config-class_method" title="OpenCensus::Trace.config (method)">config</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_notifications'>notifications</span><span class='period'>.</span><span class='id identifier rubyid_attribute_namespace'>attribute_namespace</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>myapp/</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Or, using Rails:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_opencensus'>opencensus</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_notifications'>notifications</span><span class='period'>.</span><span class='id identifier rubyid_attribute_namespace'>attribute_namespace</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>myapp/</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>### Configuring Middleware Placement</p>

<p>By default, the Railtie places the OpenCensus middleware at the end of the
middleware stack. This means it will measure your application code but not
the effect of other middleware, including middlware that is part of the
Rails stack or any custom middleware you have installed. If you would
rather place the middleware at the beginning of the stack where it
surrounds all other middleware, set the this configuration:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_config'><span class='object_link'><a href="../../Trace.html#config-class_method" title="OpenCensus::Trace.config (method)">config</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_middleware_placement'>middleware_placement</span> <span class='op'>=</span> <span class='symbol'>:begin</span>
<span class='kw'>end</span>
</code></pre>

<p>Or, using Rails:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_opencensus'>opencensus</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_middleware_placement'>middleware_placement</span> <span class='op'>=</span> <span class='symbol'>:begin</span>
</code></pre>

<p>This effectively causes the Railtie to use `unshift` rather than `use` to
add the OpenCensus middleware to the middleware stack. You may also set
this configuration to an existing middleware class to cause the OpenCensus
middleware to be inserted before that middleware in the stack. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_config'><span class='object_link'><a href="../../Trace.html#config-class_method" title="OpenCensus::Trace.config (method)">config</a></span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_config'>config</span><span class='op'>|</span>
  <span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_middleware_placement'>middleware_placement</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Rails</span><span class='op'>::</span><span class='const'>Rack</span><span class='op'>::</span><span class='const'>Logger</span>
<span class='kw'>end</span>
</code></pre>

<p>Or, using Rails:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_opencensus'>opencensus</span><span class='period'>.</span><span class='id identifier rubyid_trace'>trace</span><span class='period'>.</span><span class='id identifier rubyid_middleware_placement'>middleware_placement</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Rails</span><span class='op'>::</span><span class='const'>Rack</span><span class='op'>::</span><span class='const'>Logger</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  <dl class="constants">
    
      <dt id="DEFAULT_NOTIFICATION_EVENTS-constant" class="">DEFAULT_NOTIFICATION_EVENTS =
        <div class="docstring">
  <div class="discussion">
    
<p>The ActiveSupport notifications that will be reported as spans by default.
To change this list, update the value of the `trace.notifications.events`
configuration.</p>


  </div>
</div>
<div class="tags">
  

</div>
      </dt>
      <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sql.active_record</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>render_template.action_view</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>send_file.action_controller</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>send_data.action_controller</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>deliver.action_mailer</span><span class='tstring_end'>&quot;</span></span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
    
  </dl>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_notification_event-instance_method" title="#handle_notification_event (instance method)">#<strong>handle_notification_event</strong>(event)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Add a span based on a notification event.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_middleware-instance_method" title="#setup_middleware (instance method)">#<strong>setup_middleware</strong>(middleware_stack)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Insert middleware into the middleware stack.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup_notifications-instance_method" title="#setup_notifications (instance method)">#<strong>setup_notifications</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initialize notifications.</p>
</div></span>
  
</li>

      
    </ul>
  


  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="handle_notification_event-instance_method">
  
    #<strong>handle_notification_event</strong>(event)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Add a span based on a notification event.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159
160
161
162
163
164
165
166
167
168</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace/integrations/rails.rb', line 157</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_notification_event'>handle_notification_event</span> <span class='id identifier rubyid_event'>event</span>
  <span class='id identifier rubyid_span_context'>span_context</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_span_context'><span class='object_link'><a href="../../Trace.html#span_context-class_method" title="OpenCensus::Trace.span_context (method)">span_context</a></span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_span_context'>span_context</span>
    <span class='id identifier rubyid_ns'>ns</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../../Trace.html#configure-class_method" title="OpenCensus::Trace.configure (method)">configure</a></span></span><span class='period'>.</span><span class='id identifier rubyid_notifications'>notifications</span><span class='period'>.</span><span class='id identifier rubyid_attribute_namespace'>attribute_namespace</span>
    <span class='id identifier rubyid_span'>span</span> <span class='op'>=</span> <span class='id identifier rubyid_span_context'>span_context</span><span class='period'>.</span><span class='id identifier rubyid_start_span'>start_span</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>skip_frames:</span> <span class='int'>2</span>
    <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_start_time'>start_time</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_time'>time</span>
    <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_end_time'>end_time</span> <span class='op'>=</span> <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_end'>end</span>
    <span class='id identifier rubyid_event'>event</span><span class='period'>.</span><span class='id identifier rubyid_payload'>payload</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_k'>k</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
      <span class='id identifier rubyid_span'>span</span><span class='period'>.</span><span class='id identifier rubyid_put_attribute'>put_attribute</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ns'>ns</span><span class='embexpr_end'>}</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_k'>k</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_middleware-instance_method">
  
    #<strong>setup_middleware</strong>(middleware_stack)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Insert middleware into the middleware stack</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


128
129
130
131
132
133
134
135
136
137
138</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace/integrations/rails.rb', line 128</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_middleware'>setup_middleware</span> <span class='id identifier rubyid_middleware_stack'>middleware_stack</span>
  <span class='id identifier rubyid_where'>where</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../../Trace.html#configure-class_method" title="OpenCensus::Trace.configure (method)">configure</a></span></span><span class='period'>.</span><span class='id identifier rubyid_middleware_placement'>middleware_placement</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_where'>where</span>
  <span class='kw'>when</span> <span class='const'>Class</span>
    <span class='id identifier rubyid_middleware_stack'>middleware_stack</span><span class='period'>.</span><span class='id identifier rubyid_insert_before'>insert_before</span> <span class='id identifier rubyid_where'>where</span><span class='comma'>,</span> <span class='const'><span class='object_link'><a href="RackMiddleware.html" title="OpenCensus::Trace::Integrations::RackMiddleware (class)">RackMiddleware</a></span></span>
  <span class='kw'>when</span> <span class='symbol'>:begin</span>
    <span class='id identifier rubyid_middleware_stack'>middleware_stack</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span> <span class='const'><span class='object_link'><a href="RackMiddleware.html" title="OpenCensus::Trace::Integrations::RackMiddleware (class)">RackMiddleware</a></span></span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_middleware_stack'>middleware_stack</span><span class='period'>.</span><span class='id identifier rubyid_use'>use</span> <span class='const'><span class='object_link'><a href="RackMiddleware.html" title="OpenCensus::Trace::Integrations::RackMiddleware (class)">RackMiddleware</a></span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup_notifications-instance_method">
  
    #<strong>setup_notifications</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initialize notifications</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


144
145
146
147
148
149
150
151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/opencensus/trace/integrations/rails.rb', line 144</span>

<span class='kw'>def</span> <span class='id identifier rubyid_setup_notifications'>setup_notifications</span>
  <span class='const'><span class='object_link'><a href="../../../OpenCensus.html" title="OpenCensus (module)">OpenCensus</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Trace.html" title="OpenCensus::Trace (module)">Trace</a></span></span><span class='period'>.</span><span class='id identifier rubyid_configure'><span class='object_link'><a href="../../Trace.html#configure-class_method" title="OpenCensus::Trace.configure (method)">configure</a></span></span><span class='period'>.</span><span class='id identifier rubyid_notifications'>notifications</span><span class='period'>.</span><span class='id identifier rubyid_events'>events</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_type'>type</span><span class='op'>|</span>
    <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Notifications</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='id identifier rubyid_type'>type</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='op'>|</span>
      <span class='id identifier rubyid_event'>event</span> <span class='op'>=</span> <span class='const'>ActiveSupport</span><span class='op'>::</span><span class='const'>Notifications</span><span class='op'>::</span><span class='const'>Event</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_args'>args</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_handle_notification_event'>handle_notification_event</span> <span class='id identifier rubyid_event'>event</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Mon Mar 26 23:07:53 2018 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.12 (ruby-2.5.0).
</div>

    </div>
  </body>
</html>